<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ShelfLife Pro ğŸ’§</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <h1>ShelfLife <span class="emph">Pro</span> ğŸ’§</h1>

      <!-- AUTH -->
      <div id="authBox" class="authbox">
        <button id="btnLoginEmail" class="btn primary">ğŸ” Accedi (Email)</button>
        <button id="btnLoginGoogle" class="btn ghost">G</button>
        <span id="userBadge" class="pill" style="display:none"></span>
        <button id="btnLogout" class="btn" style="display:none">Esci</button>
      </div>
    </header>

    <main class="grid">
      <!-- EDITOR -->
      <section class="card editor">
        <div class="row gap">
          <input id="recipeName" class="input name" placeholder="Nome ricetta (es. Pan di Spagna Classico)" />
          <select id="categoria" class="input">
            <option value="">â€” Categoria â€”</option>
            <option value="Basi cotte">Basi cotte</option>
            <option value="Basi crude / Creme">Basi crude / Creme</option>
            <option value="Lievitati dolci">Lievitati dolci</option>
            <option value="Gluten free / Speciali">Gluten free / Speciali</option>
            <option value="Varie o semilavorati">Varie o semilavorati</option>
          </select>
          <label class="radio"><input type="radio" name="tipoProdotto" value="crudo" checked /> Crudo</label>
          <label class="radio"><input type="radio" name="tipoProdotto" value="cotto" /> Cotto</label>
        </div>

        <textarea id="descrizione" class="input" rows="2" placeholder="Descrizione breve (facoltativa)"></textarea>

        <div class="row gap">
          <button id="btnNew" class="btn">ğŸ†• Nuova</button>
          <button id="btnDuplicate" class="btn">ğŸ“„ Duplica</button>
          <button id="btnSave" class="btn success">ğŸ’¾ Salva</button>
          <span id="statusBox" class="muted"></span>
        </div>

        <div class="tablewrap">
          <table id="ingredienti">
            <thead>
              <tr>
                <th>Ingrediente</th><th>g</th><th>% Hâ‚‚O</th><th>aw</th>
                <th>Acqua Totale</th><th>Acqua Libera</th><th>â€”</th>
              </tr>
            </thead>
            <!-- Campo ingrediente con datalist e tasto per aggiungerne di nuovi -->
<tr class="ingredient-input-row">
  <td colspan="7">
    <div style="display:flex; gap:8px; align-items:center;">
      <input id="ing-name-input" list="ingredients-datalist" placeholder="Cerca ingrediente..." style="flex:1;" />
      <datalist id="ingredients-datalist"></datalist>
      <button id="btn-add-ingredient" type="button" class="btn" title="Aggiungi nuovo ingrediente">â•</button>
    </div>
  </td>
</tr>

<!-- Dialog per aggiungere o modificare ingredienti -->
<dialog id="dlg-ingredient">
  <form method="dialog" id="dlg-ingredient-form" style="display:flex; flex-direction:column; gap:8px; min-width:250px;">
    <h3 id="dlg-ingredient-title">Aggiungi ingrediente</h3>

    <label>Nome
      <input id="dlg-name" required />
    </label>

    <label>% Hâ‚‚O
      <input id="dlg-water" type="number" min="0" max="100" step="0.1" required />
    </label>

    <label>aw
      <input id="dlg-aw" type="number" min="0" max="1" step="0.01" required />
    </label>

    <label>Note (facoltative)
      <input id="dlg-note" />
    </label>

    <div style="display:flex; justify-content:space-between; margin-top:6px;">
      <button value="cancel">Annulla</button>
      <button id="dlg-save" value="default" class="primary">Salva</button>
    </div>
  </form>
</dialog>

<small><a href="#" id="link-manage-ingredients">Gestisci ingredienti personali</a></small>
            <tbody></tbody>
          </table>
          <button id="btnAdd" class="btn line">+ Aggiungi riga</button>
        </div>

        <div class="results">
          <div><b>Totale acqua:</b> <span id="totAcqua">0.0 g</span></div>
          <div><b>Acqua libera:</b> <span id="totLibera">0.0 g</span></div>
          <div><b>aw media:</b> <span id="awMedia">0.00</span></div>
          <div><b>Rischio:</b> <span id="rischio">â€”</span></div>
          <div><b>Shelf life stimata:</b> <span id="shelfLife">â€”</span></div>
          <div><b>Conservazione:</b> <span id="consigli">â€”</span></div>
        </div>

        <textarea id="notePrivate" class="input" rows="3" placeholder="Note private (visibili solo a te)"></textarea>
      </section>

      <!-- ARCHIVIO -->
      <aside class="card archivio">
        <h3>ğŸ“ Archivio ricette</h3>
        <div id="archivioBox" class="list"></div>
      </aside>

      <!-- TABELLA AW -->
      <section class="card aw">
        <h3>ğŸ’§ Interpretazione valori aw</h3>
        <table class="awtab">
          <thead><tr><th>Indicatore</th><th>aw</th><th>StabilitÃ </th><th>Rischio</th></tr></thead>
          <tbody>
            <tr><td><span class="dot red"></span></td><td>0.95â€“1.00</td><td>Altissima umiditÃ </td><td>Altissimo (batteri+muffe)</td></tr>
            <tr><td><span class="dot yellow"></span></td><td>0.85â€“0.94</td><td>Media umiditÃ </td><td>Medio (muffe/lieviti)</td></tr>
            <tr><td><span class="dot green"></span></td><td>0.65â€“0.84</td><td>Stabile</td><td>Basso</td></tr>
            <tr><td><span class="dot lightgreen"></span></td><td>&lt;0.60</td><td>Secco</td><td>Minimo</td></tr>
          </tbody>
        </table>
      </section>
    </main>
  </div>

  <script type="module" src="scripts/supabaseClient.js"></script>
  <script type="module" src="assets/app.js"></script>
</body>
</html>
